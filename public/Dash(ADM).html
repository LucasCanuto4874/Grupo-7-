<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard com Gráficos</title>
    <link rel="stylesheet" href="css/Dashboard(JoaoLazaro).css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="inicializarGraficos()">

    <div class="NavBar">
        <div><img class="LogoNavBar" src="./assets/Logo Quantum.svg" alt=""></div>
        <div class="div1">
            <a class="botaoNavBar" href="">
                <p>Home</p>
            </a>
            <a class="botaoNavBar" href="">
                <p>Previsões</p>
            </a>
            <a class="botaoNavBar" href="">
                <p>Funcionário</p>
            </a>
            <a class="botaoNavBar" href="">
                <p>Servidor</p>
            </a>
            <a class="botaoNavBar" href="">
                <p>Perfil</p>
            </a>
        </div>
    </div>

    <section class="Monitoramento">
        <div>
            <h1 class="TituloBem-Vindo">Olá, Usuário!</h1>
            <p class="TituloBem-Vindo">Monitoramento do dia: DD/MM/AAAA</p>
            <p class="Paragrafo_Bem-vindo">Alertas e Informações Por Componente</p>
        </div>

        <div class="div1-container">
            <div class="box1">
                <div class="DivComponente">
                    <h1 class="TituloComponentes">Componentes que passaram <br> do limite, por servidor.</h1>
                </div>

                <div class="DivAlertas"><canvas id="graficoAlerta"></canvas>
                    <h1 class="tituloAlertas">Números de alerta <br> gerado por componente (Semanal)</h1>
                </div>
                <!-- <h1 class="tituloAlertas" >Números de alerta <br> gerado por componente</h1></div> -->

            </div>
            <div class="box2">
                <div class="card1">
                    <p class="TotalServidores">Total de servidores <br><br>
                    <div class="textoCard1">20</div>
                    </p>
                </div>
                <div class="card2">
                    <div class="tituloQuadrante">Status dos servidores</div>
                    <!-- <canvas class="" id="graficoStatus"></canvas> -->
                </div>
            </div>

            <p class="Titulo_Grafico_CPU">Uso de CPU (%)</p>
            <div class="card3"><canvas id="graficoCPU"></canvas></div>
            <p class="Titulo_Grafico_Memoria">Uso de Memória RAM (%)</p>
            <div class="card4"><canvas id="graficoMemoria"></canvas></div>
            <p class="Titulo_Grafico_Disco">Uso de Disco (%)</p>
            <div class="card5"><canvas id="graficoDisco"></canvas></div>
        </div>

        </div>
        <div class="card8"><canvas id="graficoUptime"></canvas></div>
        <div class="card7"><canvas id="graficoStatus"></canvas></div>
    </section>

    <script>

        function inicializarGraficos() {
            criarGraficoCPU();
            criarGraficoMemoria();
            criarGraficoDisco();
            criarGraficoUptime();
            criarGraficoAlerta();
            criarNumeroStatus()
        }

        function criarNumeroStatus() {
            fetch(`/graficos/NumeroAtividade:idServidor`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoStatus(resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarGraficoStatus(resposta) { // Define `resposta` como parâmetro
            console.log('iniciando plotagem do gráfico...');

            let labels = ['Desativados', 'Ativados', 'Servidor - 3'];
            let dadosCPU = {
                labels: labels,
                datasets: [
                    {
                        label: 'Status dos servidores',
                        data: [],
                        backgroundColor: 'white',
                        borderColor: 'white',
                        borderWidth: 1,
                        font:{
                            size: 10
                        }
                    }
                ]
            };

            console.log('----------------------------------------------');
            console.log('Estes dadosCPU foram recebidos pela funcao "obterdadosCPUGrafico" e passados para "plotarGraficoPeso":');
            console.log(resposta);

            resposta.forEach((registro) => {
                console.log(registro);  // Verifique a estrutura dos dados aqui
                dadosCPU.datasets[0].data.push(registro.total);
            });


            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:', labels);
            console.log('dadosCPU:', dadosCPU.datasets);
            console.log('----------------------------------------------');

            const config = {
                type: 'bar',
                data: dadosCPU,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        // title: {
                        //     display: true,
                        //     text: 'STATUS SERVIDOR',
                        //     color: 'white',
                        //     font: {
                        //         size: 10
                        //     }
                        // },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white', // Cor dos ticks (valores)
                                // callback: function (value) {
                                //     return value + '%'; // Adiciona '%' aos valores
                                // },
                                stepSize: 5, // Define o intervalo entre os valores
                            },
                            max: 30, // Define o valor máximo do eixo Y
                            min: 1, // Define o valor mínimo do eixo Y
                        }

                    }
                }
            };

            let myChart = new Chart(
                document.getElementById(`graficoStatus`),
                config
            );
        }




        function criarGraficoCPU() {
            fetch(`/graficos/MediaCPU:idServidor`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoMediaCPU(resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarGraficoMediaCPU(resposta) { // Define `resposta` como parâmetro
            console.log('iniciando plotagem do gráfico...');

            let labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            let dadosCPU = {
                labels: labels,
                datasets: [
                    {
                        label: 'Média CPU',
                        data: [],
                        backgroundColor: 'white',
                        borderColor: 'white',
                        borderWidth: 1
                    }
                ]
            };

            console.log('----------------------------------------------');
            console.log('Estes dadosCPU foram recebidos pela funcao "obterdadosCPUGrafico" e passados para "plotarGraficoPeso":');
            console.log(resposta);

            resposta.forEach((registro) => {
                console.log(registro);  // Verifique a estrutura dos dados aqui
                dadosCPU.datasets[0].data.push(registro.mediaUsoCPU);
            });


            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:', labels);
            console.log('dadosCPU:', dadosCPU.datasets);
            console.log('----------------------------------------------');

            const config = {
                type: 'bar',
                data: dadosCPU,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Uso de CPU Semanal',
                            color: 'white',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white',
                                callback: function (value) { return value + '%' }
                            },
                            max: 100,
                        }
                    }
                }
            };

            let myChart = new Chart(
                document.getElementById(`graficoCPU`),
                config
            );
        }


        function criarGraficoMemoria() {
            fetch(`/graficos/MediaRAM:idServidor`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoMediaRAM(resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarGraficoMediaRAM(resposta) { // Define `resposta` como parâmetro
            console.log('iniciando plotagem do gráfico...');

            let labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            let dadosCPU = {
                labels: labels,
                datasets: [
                    {
                        label: 'Média RAM',
                        data: [],
                        backgroundColor: 'white',
                        borderColor: 'white',
                        borderWidth: 1
                    }
                ]
            };

            console.log('----------------------------------------------');
            console.log('Estes dadosCPU foram recebidos pela funcao "obterdadosCPUGrafico" e passados para "plotarGraficoPeso":');
            console.log(resposta);

            resposta.forEach((registro) => {
                console.log(registro);  // Verifique a estrutura dos dados aqui
                dadosCPU.datasets[0].data.push(registro.mediaUsoRAM);
            });


            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:', labels);
            console.log('dadosCPU:', dadosCPU.datasets);
            console.log('----------------------------------------------');

            const config = {
                type: 'bar',
                data: dadosCPU,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Uso de CPU Semanal',
                            color: 'white',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white',
                                callback: function (value) { return value + '%' }
                            },
                            max: 100,
                        }
                    }
                }
            };

            let myChart = new Chart(
                document.getElementById(`graficoMemoria`),
                config
            );
        }

        function criarGraficoDisco() {
            fetch(`/graficos/MediaDisco:idServidor`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoMediaDisco(resposta);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        function plotarGraficoMediaDisco(resposta) { // Define `resposta` como parâmetro
            console.log('iniciando plotagem do gráfico...');

            let labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            let dadosCPU = {
                labels: labels,
                datasets: [
                    {
                        label: 'Média RAM',
                        data: [],
                        backgroundColor: 'white',
                        borderColor: 'white',
                        borderWidth: 1
                    }
                ]
            };

            console.log('----------------------------------------------');
            console.log('Estes dadosCPU foram recebidos pela funcao "obterdadosCPUGrafico" e passados para "plotarGraficoPeso":');
            console.log(resposta);

            resposta.forEach((registro) => {
                console.log(registro);  // Verifique a estrutura dos dados aqui
                dadosCPU.datasets[0].data.push(registro.mediaUsoDisco);
            });


            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:', labels);
            console.log('dadosCPU:', dadosCPU.datasets);
            console.log('----------------------------------------------');

            const config = {
                type: 'bar',
                data: dadosCPU,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Uso de CPU Semanal',
                            color: 'white',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white',
                                callback: function (value) { return value + '%' }
                            },
                            max: 100,
                        }
                    }
                }
            };

            let myChart = new Chart(
                document.getElementById(`graficoDisco`),
                config
            );
        }

        function criarGraficoAlerta() {
            new Chart(document.getElementById('graficoAlerta'), {
                type: 'bar',
                data: {
                    labels: ['CPU', 'RAM', 'Disco'],
                    datasets: [{
                        label: '',
                        color: '#7449EB',
                        data: [65, 59, 80, 81, 56, 55, 50],
                        backgroundColor: 'white',
                        borderColor: 'white',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Alerta Por Componente',
                            color: 'white',
                            font: {
                                size: 18
                            }
                        },
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        function criarGraficoUptime() {

            fetch(`/graficos/uptime:idServidor`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoUptime(resposta);

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });
        }

        let myChartUptime;

        function plotarGraficoUptime(resposta) {
            console.log('iniciando plotagem do gráfico...');

            if (myChartUptime) {
                myChartUptime.destroy();
            }


            let labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            let dados = {
                labels: labels,
                datasets: [
                    {
                        label: 'Servidor 1 - Uptime (%)',
                        data: [],
                        backgroundColor: 'yellow',
                        borderColor: 'yellow',
                        borderWidth: 1
                    },
                    {
                        label: 'Servidor 2 - Uptime (%)',
                        data: [],
                        backgroundColor: '#ff6af5',
                        borderColor: '#ff6af5',
                        borderWidth: 1
                    },
                    {
                        label: 'Servidor 3 - Uptime (%)',
                        data: [],
                        backgroundColor: 'blue',
                        borderColor: 'blue',
                        borderWidth: 1
                    }
                ]
            };

            console.log('----------------------------------------------');
            console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGraficoPeso":');
            console.log(resposta);


            resposta.forEach((registro) => {
                dados.datasets[0].data.push(registro.uptime_percent * 100);
                dados.datasets[1].data.push(registro.uptime_percent * 100);
                dados.datasets[2].data.push(registro.uptime_percent * 100);
            });

            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:', labels);
            console.log('Dados:', dados.datasets);
            console.log('----------------------------------------------');


            const config = {
                type: 'bar',
                data: dados,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Uptime Semanal dos Servidores',
                            color: 'white',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white',
                                callback: function (value) { return value + '%' }
                            },
                            max: 100,
                        }
                    }
                }
            };

            myChartUptime = new Chart(document.getElementById('graficoUptime'), config);
        }


    </script>

</body>

</html>