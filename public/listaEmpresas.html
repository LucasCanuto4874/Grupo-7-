<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Empresas</title>

    <link rel="icon" href="img/Logo Quantum.svg" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/listaEmpresas.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="navbar">
        <div class="logo-container">
            <img src="assets/Logo Quantum (1).svg" class="logo-nav" alt="">
        </div>
        <div class="nav-links">
            <div class="nav-button">
                <img src="img/empresaicon.svg" class="nav-icon" alt="">
                <p><a style="text-decoration: none; color: white;" href="listaEmpresas.html"
                        class="nav-link">Empresas</a></p>
            </div>
            <div class="nav-button">
                <img src="assets/funcionarios-icon.svg" class="nav-icon" alt="">
                <p><a style="text-decoration: none; color: white;" href="cadastrar.html" class="nav-link">Cadastro
                        ADM</a></p>
            </div>
        </div>
        <div class="logout-container">
            <div class="nav-button">
                <img src="assets/Vectorexit.svg" class="nav-icon" alt="">
                <p><a style="text-decoration: none; color: white;" href="login.html" class="nav-link">Logout</a></p>
            </div>
        </div>
    </div>

    <div class="empresa-list-container" id="empresa-list-container">
        <div class="list-title">
            <img class="list-icon" src="img/empresa.svg" alt="">
        </div>
        <div class="add-button-container">
            <button id="btncadastrarEmpresa" class="btn-add-empresa" onclick="aparecercard()">Cadastrar empresa</button>
        </div>

        <div class="empresa-list">
            <table>
                <thead>
                    <tr class="table-header">
                        <th>Nome</th>
                        <th>CNPJ</th>
                        <th>Administrador</th>
                        <th>Endereço</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>

        <div id="modalCadastroEmpresa" class="modalEmpresa">
            <span class="modal-close" onclick="fecharModal1()">&times;</span>
            <div class="conteudos-modal">
                <h2>Cadastre uma nova empresa</h2>
                <div class="boxEmpresa">
                    <span>Nome:</span>
                    <input type="text" id="razaosocial" class="input-empresa" class="container_radiu"></input>
                </div>
                <div class="boxEmpresa">
                    <span>CNPJ:</span>
                    <input type="email" id="cnpj" class="input-empresa" class="container_radiu"></input>
                </div>
                <div class="boxEmpresa">
                    <button onclick="cadastroEmpresa()" class="botaoAvancar" class="input-empresa">Avançar</button>
                </div>
                <input type="hidden" id="idEmpresa" value="">
            </div>
        </div>

        <div id="modalCadastroEndereco" class="modalEmpresa">
            <div class="conteudos-modal">
                <h2>Digite o endereço da empresa a ser cadastrada</h2>
                <div class="boxEmpresa">
                    <span>CEP:</span>
                    <input type="text" id="cep" class="input-empresa" class="container_radiu"></input>
                </div>
                <div class="boxEmpresa">
                    <span>Rua:</span>
                    <input type="email" id="rua" class="input-empresa" class="container_radiu"></input>
                </div>
                <div class="boxEmpresa">
                    <span>Complemento:</span>
                    <input type="email" id="complemento" class="input-empresa" class="container_radiu"></input>
                </div>
                <div class="boxEmpresa">
                    <span>Número:</span>
                    <input type="email" id="num" class="input-empresa" class="container_radiu" placeholder=""></input>
                </div>
                <div class="boxEmpresa">
                    <button onclick="cadastroEndereco()" class="botaoAvancar" class="input-empresa">Avançar</button>
                </div>
            </div>
        </div>

        <div id="modalCadastroAdm" class="modalEmpresa">
            <div class="conteudos-modal">
                <h2>É necessário realizar um cadastro de um administrador da empresa.</h2>
                <div class="boxEmpresa">
                    <button onclick="window.location='cadastrar.html'" class="botaoAvancar" class="input-empresa">Ir
                        para o cadastro</button>
                </div>
            </div>
        </div>

    </div>
</body>

</html>
<script>
    // Função para abrir o modal com os detalhes da empresa

    function fecharModal1() {
        var span = document.getElementById("modalCadastroEmpresa");
        span.style.display = "none";
    }



    function aparecercard() {
        var span = document.getElementById("modalCadastroEmpresa");
        var info = document.getElementById('empresa-list-container')
        info.style.filter = 'blur(2)'
        span.style.display = "block";
    }

    function cadastroEmpresa() {
        var cardEmpresa = document.getElementById('modalCadastroEmpresa')
        var cardEndereco = document.getElementById('modalCadastroEndereco')


        var nomeEmpresa = document.getElementById("razaosocial").value;
        var cnpjEmpresa = document.getElementById("cnpj").value;

        console.log(nomeEmpresa);
        console.log(cnpjEmpresa);

        fetch("/empresas/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeEmpresa: nomeEmpresa,
                cnpjEmpresa: cnpjEmpresa,
            }),
        })
        .then(function (resposta) {
        if (resposta.ok) {
            return resposta.json(); // Retorne o resultado como JSON
        } else {
            throw new Error("Erro no cadastro. Status: " + resposta.status);
        }
    })
    .then(function (resultado) {
        alert("Cadastro feito com sucesso!");
        var idEmpresa = resultado.insertId; // Armazene o ID da empresa cadastrada

        // Armazenar o id da empresa para o cadastro do endereço
        document.getElementById("idEmpresa").value = idEmpresa; // Crie um input oculto para armazenar o ID
        
        // Agora abra o modal para cadastro do endereço
        cardEmpresa.style.display = 'none';
        cardEndereco.style.display = 'block';
    })
    .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
        alert("Um erro ocorreu: " + erro.message);
    });

    return false;
    }

    function cadastroEndereco() {
        var cardEndereco = document.getElementById('modalCadastroEndereco')
        var cardAdm = document.getElementById('modalCadastroAdm')

        var cep = document.getElementById("cep").value;
        var rua = document.getElementById("rua").value;
        var complemento = document.getElementById("complemento").value;
        var numero = document.getElementById("num").value;
        var idEmpresa = document.getElementById("idEmpresa").value; // Obtenha o ID da empresa

        fetch("/empresas/cadastrarEnd", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                cep: cep,
                rua: rua,
                complemento: complemento,
                numero: numero,
                idEmpresa: idEmpresa // Inclua o ID da empresa no corpo
            }),
        })
         .then(function (resposta) {
        if (resposta.ok) {
            return resposta.json(); // Retorne o resultado como JSON
        } else {
            throw new Error("Erro no cadastro. Status: " + resposta.status);
        }
    })
    .then(function (resultado) {
        alert("Cadastro feito com sucesso!");
        var idEmpresa = resultado.insertId; // Armazene o ID da empresa cadastrada

        // Armazenar o id da empresa para o cadastro do endereço
        document.getElementById("idEmpresa").value = idEmpresa; // Crie um input oculto para armazenar o ID
        
        // Agora abra o modal para cadastro do user
        cardEndereco.style.display = 'none'
        cardAdm.style.display = 'block'
    })
    .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
        alert("Um erro ocorreu: " + erro.message);
    });

    return false;
    }

    function listarServidor() {
    fetch(`/empresas/buscar`, {
        method: "GET",
        headers: {
            "Content-Type": "application/json"
        }
    })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(data);
            const tbody = document.querySelector('#tabela-servidores tbody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 5;
                cell.textContent = 'Nenhum Registro encontrado.';
                row.appendChild(cell);
                tbody.appendChild(row);
            } else {
                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${item.idServidor}</td>
                    <td>${item.nomeServidor}</td>
                    <td>${item.razao_social}</td>
                    <td>${item.tipo}</td>
                    <td><button onclick="mostrarEditar()" class="btn-icon"><img class="img-iconsEdit" src="assets/iconlapis.png" alt=""></button></td>
                    <td><button onclick="excluirServidor()" class="btn-icon"><img class="img-iconsEdit" src="assets/iconLixeira.svg" alt=""></button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        })
        .catch(error => {
            console.error('Houve um erro ao capturar os dados', error);
        });
}

</script>